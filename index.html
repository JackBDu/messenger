<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Messenger</title>
    <meta charset="UTF-8">
  </head>
  <body>
    <header>
      <div id="signin_header">
        <input id="user_id" placeholder="username"></input>
        <button id="signin" onclick="signin();">Sign In</button>
        <button id="signin" onclick="signin();">Sign Up</button>
        <span id="signin_error"></span>
      </div>
      <div id="hello_header" class="hide">
        <span id="user_id_display"></span>
        <button id="signout" onclick="signout();">Log Out</button>
      </div>
    </header>
    <content>
      <div id="messages_wrappers"></div>
      <div id="active_list_wrapper"></div>
    </content>
    <footer></footer>
  </body>
  <style>
    * {
      margin: 0;
      padding: 0;
      outline: none;
      border: 0;
    }
    html, body {
      width: 100%;
      height: 100%;
    }
    .hide {
      display: none;
    }
    #user_id {
      font-size: 1em;
      width: 10em;
      height: 2em;
      background: #eef;
      padding: 0 0.5em;
    }
    #signup, #signin {
      margin: 0;
      font-size: 1em;
      background: #ddf;
      width: 5em;
      height: 2em;
    }
  </style>
  <script>

    var user_id = "";

		document.getElementById("user_id")
				.addEventListener("keyup", function(event) {
				event.preventDefault();
				if (event.keyCode == 13) {
						document.getElementById("send").click();
				}
		});

		function signup() {
      user_id = document.getElementById("user_id").value;
			console.log("signup: "+user_id);
			sendToServer("signup"+"?user_id"+"="+user_id);
		}

		function signin() {
			console.log("signin: "+user_id);
			sendToServer("signin","?user_id"+"="+user_id);
		}

    function displayHelloHeader() {
      document.getElementById("signin_header").display = "none";
      document.getElementById("hello_header").innerHTML = user_id;
      document.getElementById("hello_header").display = "block";
    }

    function updateChatList() {
      console.log("updating chat list");
    }

    function displayError(msg) {
      document.getElementById("signin_error").innerHTML = msg;
    }

		function sendToServer(cmd, info="") {
			var xhttp = new XMLHttpRequest();
			xhttp.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {
          var response = JSON.parse(this.responseText);
          console.log(response);
          if (cmd == "get_list") {
            updateChatList(response);
          }
          else if (cmd == "signin") {
            if (response[0]) {
              displayHelloHeader();
              sendToServer("active_list");
            } else {
              console.log("user not found");
              displayError("Username not found.");
            }
          } else if (cmd == "signup") {
            if (response[0]) {
              displayHelloHeader();
              sendToServer("active_list");
            } else {
              console.log("already exists");
              displayError("Username already exists.");
            }
          }
        } else if (this.readyState == 4 && this.status == 404) {
          displayError("File not found");
        }
			};
			xhttp.open("GET", cmd+info, true);
			xhttp.send();
		}

  </script>
</html>
